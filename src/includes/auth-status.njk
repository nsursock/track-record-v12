<!-- Authentication Status Component -->
<div x-data="{ 
  showUserMenu: false, 
  avatarError: false,
  init() {
    console.log('Auth status component initialized');
    this.$watch('$store.auth.isAuthenticated', (value) => {
      console.log('Auth status changed:', value);
    });
  }
}" class="relative" x-show="!$store.auth.loading">
  <!-- Authenticated User -->
  <div x-show="$store.auth.isAuthenticated" class="flex items-center gap-4">
    <!-- User Avatar & Menu -->
    <div class="relative">
      <button 
        @click="showUserMenu = !showUserMenu"
        class="flex items-center gap-2 hover:opacity-80 transition-opacity"
        aria-haspopup="menu"
        :aria-expanded="showUserMenu"
        aria-label="User menu"
      >
        <div class="avatar">
          <div class="w-10 rounded-box ring ring-primary ring-offset-base-100 ring-offset-2">
            <template x-if="$store.auth.userAvatar && !avatarError">
              <img 
                :src="$store.auth.userAvatar"
                :alt="$store.auth.userName"
                @error="avatarError = true"
              />
            </template>
            <template x-if="!$store.auth.userAvatar || avatarError">
              <div class="bg-primary text-primary-content w-full h-full flex items-center justify-center">
                <span class="text-lg font-semibold leading-none" x-text="$store.auth.userName.split('@')[0].split('.').map(n => n[0]).join('').toUpperCase()"></span>
              </div>
            </template>
          </div>
        </div>
      </button>

      <!-- User Menu Dropdown -->
      <div 
        x-show="showUserMenu"
        @click.away="showUserMenu = false"
        x-transition:enter="transition ease-out duration-100"
        x-transition:enter-start="transform opacity-0 scale-95"
        x-transition:enter-end="transform opacity-100 scale-100"
        x-transition:leave="transition ease-in duration-75"
        x-transition:leave-start="transform opacity-100 scale-100"
        x-transition:leave-end="transform opacity-0 scale-95"
        class="absolute right-0 top-full mt-2 w-56 bg-base-100 rounded-box divide-y divide-base-300 shadow-lg z-50"
      >
        <div class="py-3 px-4">
          <span class="block text-sm font-semibold text-base-content" x-text="$store.auth.userName"></span>
          <span class="block text-sm text-base-content/70 truncate" x-text="$store.auth.userEmail"></span>
        </div>
        <ul class="py-1 text-base-content/70" aria-labelledby="dropdown">
          <li>
            <a href="/profile" class="flex items-center py-2 px-4 text-sm hover:bg-base-200">
              <span class="icon-[tabler--user] size-4 mr-2"></span>
              My profile
            </a>
          </li>
          <li>
            <a href="/settings" class="flex items-center py-2 px-4 text-sm hover:bg-base-200">
              <span class="icon-[tabler--settings] size-4 mr-2"></span>
              Account settings
            </a>
          </li>
        </ul>
        <ul class="py-1 text-base-content/70" aria-labelledby="dropdown">
          <li>
            <a href="#" class="flex items-center py-2 px-4 text-sm hover:bg-base-200">
              <span class="icon-[tabler--heart] size-4 mr-2"></span>
              My likes
            </a>
          </li>
          <li>
            <a href="#" class="flex items-center py-2 px-4 text-sm hover:bg-base-200">
              <span class="icon-[tabler--bookmark] size-4 mr-2"></span>
              Collections
            </a>
          </li>
        </ul>
        <ul class="py-1 text-base-content/70" aria-labelledby="dropdown">
          <li>
            <button 
              @click="async () => {
                try {
                  await $store.auth.signOut();
                  showUserMenu = false;
                  window.location.href = '/';
                } catch (err) {
                  console.error('Sign out error:', err);
                }
              }"
              class="flex items-center w-full py-2 px-4 text-sm hover:bg-base-200 text-error"
            >
              <span class="icon-[tabler--logout] size-4 mr-2"></span>
              Sign out
            </button>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Not Authenticated -->
  <div x-show="!$store.auth.isAuthenticated" class="flex items-center gap-2">
    <a href="/credentials/" class="btn btn-sm btn-primary">
      Get Started
    </a>
  </div>

  <!-- Loading State -->
  <div x-show="$store.auth.loading" class="flex items-center gap-2">
    <span class="loading loading-spinner loading-sm"></span>
    <span class="text-sm text-base-content/70">Loading...</span>
  </div>
</div> 