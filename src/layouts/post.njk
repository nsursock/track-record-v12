---
layout: base
---

<!-- Debug Information -->
<div class="hidden">
  Debug Info:
  Author: {{ author | dump }}
  Title: {{ title | dump }}
  Tags: {{ tags | dump }}
  Published Date: {{ published_date | dump }}
  Content Length: {{ content | length }}
</div>

<article class="mt-12 py-12 px-4 mx-auto max-w-screen-xl lg:py-16">
  <!-- Hero Section -->
  <header class="mb-8 lg:mb-12">
    <div class="grid grid-cols-1 lg:grid-cols-5 gap-8 items-center">
      <!-- Left Column: Content -->
      <div class="col-span-2">
        <div class="flex flex-wrap items-center gap-4 mb-4">
          {% if tags %}
            {% for tag in tags %}
              <span class="badge badge-soft {% if loop.first %}badge-primary{% else %}badge-secondary{% endif %}">
                {{ tag }}
              </span>
            {% endfor %}
          {% endif %}
        </div>
        <h1 class="mb-4 text-3xl font-bold leading-tight text-gray-900 lg:mb-6 lg:text-4xl dark:text-white">
          {{ title }}
        </h1>
        {% if meta_description %}
          <p class="mb-6 text-lg text-gray-600 dark:text-gray-400">
            {{ meta_description }}
          </p>
        {% endif %}
        <div class="flex items-center space-x-4">
          <div class="flex items-center space-x-2">
            {% if author %}
              <img class="w-10 h-10 rounded-full ring-2 ring-primary-200" src="https://i.pravatar.cc/150?u={{ author | urlencode }}" alt="{{ author }}">
              <div class="font-medium dark:text-white">
                <div>{{ author }}</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">
                  {% if published_date %}
                    {{ published_date }}
                  {% endif %}
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Right Column: Hero Image -->
      <div class="relative h-[400px] lg:h-[500px] rounded-lg overflow-hidden col-span-3">
        {% set heroMatch = content | regexFind('<img[^>]*>') %}
        {% if heroMatch and heroMatch[0] %}
          {% set srcMatch = heroMatch[0] | regexFind('src="([^"]+)"') %}
          {% if srcMatch and srcMatch[1] %}
            {% set heroImage = srcMatch[1] %}
            {% if 'unsplash.com' in heroImage %}
              {% set transformedUrl = heroImage ~ '&w=800&h=600' %}
              <img src="{{ transformedUrl }}" 
                   alt="{{ title }}"
                   class="object-cover w-full h-full"
                   loading="eager">
            {% else %}
              <img src="{{ heroImage | replace('upload/', 'upload/c_fill,w_800,h_450,g_auto,q_auto,f_auto/') }}" 
                   alt="{{ title }}"
                   class="object-cover w-full h-full"
                   loading="eager">
            {% endif %}
          {% endif %}
        {% endif %}
      </div>
    </div>
  </header>

  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Main Content -->
    <div class="lg:col-span-2">
      <!-- Article Content -->
      <div class="prose prose-lg max-w-none dark:prose-invert 
        prose-headings:prose-headings:font-bold
        prose-h1:text-4xl prose-h2:text-3xl prose-h3:text-2xl
        prose-p:text-gray-600 dark:prose-p:text-gray-300
        prose-a:text-primary-600 dark:prose-a:text-primary-400 prose-a:no-underline hover:prose-a:underline
        prose-strong:text-gray-900 dark:prose-strong:text-white
        prose-code:text-primary-600 dark:prose-code:text-primary-400
        prose-pre:bg-gray-900 dark:prose-pre:bg-gray-800
        prose-blockquote:border-l-primary-500 prose-blockquote:bg-gray-50 dark:prose-blockquote:bg-gray-800
        prose-img:rounded-lg prose-img:shadow-md
        prose-hr:border-gray-200 dark:prose-hr:border-gray-700
        prose-li:marker:text-primary-500
        prose-table:border-gray-200 dark:prose-table:border-gray-700
        prose-th:bg-gray-50 dark:prose-th:bg-gray-800"
        x-data="{ imageCount: 0 }"
        x-init="$el.querySelectorAll('p > img').forEach(img => {
          const p = img.parentElement;
          p.classList.add('float-image');
          p.classList.add(imageCount % 2 === 0 ? 'float-right' : 'float-left');
          imageCount++;
        })">
        <style>
          .float-image {
            clear: both;
            margin-top: 0.1rem;
            margin-bottom: 0.1rem;
          }
          .float-image img {
            margin-bottom: 1rem;
            width: 100%;
            height: auto;
            margin-left: auto;
            margin-right: auto;
          }
          @media (min-width: 1024px) {
            .float-image img {
              max-width: 300px;
              margin-left: 0;
              margin-right: 0;
            }
            .float-right img {
              float: right;
              margin-left: 2rem;
            }
            .float-left img {
              float: left;
              margin-right: 2rem;
            }
          }
        </style>
        {% if heroMatch and heroMatch[0] %}
          {% set contentAfterFirstImage = content | replace(heroMatch[0], '') %}
          {{ contentAfterFirstImage | safe }}
        {% else %}
          {{ content | safe }}
        {% endif %}
      </div>

      <!-- Article Footer -->
      <footer class="mt-8 lg:mt-12">
        <!-- Tags -->
        {% if tags %}
          <div class="mb-8">
            <h2 class="mb-4 text-xl font-bold text-gray-900 dark:text-white">Tags</h2>
            <div class="flex flex-wrap gap-2">
              {% for tag in tags %}
                <a href="/tags/{{ tag | urlencode }}" class="badge badge-soft {% if loop.first %}badge-primary{% else %}badge-secondary{% endif %}">
                  {{ tag }}
                </a>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <!-- Comments Section -->
        {% if comments %}
          <div class="mt-12">
            <h2 class="mb-8 text-2xl font-bold text-gray-900 dark:text-white">Comments</h2>
            <div class="space-y-6">
              {% for comment in comments %}
                <article class="p-6 text-base bg-white rounded-lg shadow-sm dark:bg-gray-900">
                  <footer class="flex justify-between items-center mb-2">
                    <div class="flex items-center">
                      <img class="mr-2 w-8 h-8 rounded-full ring-2 ring-primary-200" src="{{ comment.avatar }}" alt="{{ comment.name }}">
                      <div class="inline-flex items-center mr-3 text-sm text-gray-900 dark:text-white">
                        <cite class="font-semibold">{{ comment.name }}</cite>
                      </div>
                      <p class="text-sm text-gray-600 dark:text-gray-400">
                        {% if comment.published_date %}
                          {{ comment.published_date }}
                        {% endif %}
                      </p>
                    </div>
                  </footer>
                  <p class="text-gray-500 dark:text-gray-400">{{ comment.text }}</p>
                </article>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <!-- Navigation -->
        <div class="mt-12 flex items-center justify-between">
          <a href="/posts" class="inline-flex items-center font-medium text-primary-600 hover:text-primary-800 dark:text-primary-500 dark:hover:text-primary-400">
            <svg class="mr-2 h-4 w-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M7.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
            </svg>
            Back to Articles
          </a>
        </div>
      </footer>
    </div>

    <!-- Right Sidebar -->
    <div class="lg:col-span-1">
      <div class="sticky top-24">
        <!-- Author Bio -->
        {% if author %}
          <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-900 mb-8">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">About the Author</h3>
            <div class="flex items-center space-x-4 mb-4">
              <img class="w-16 h-16 rounded-full ring-2 ring-primary-200" src="https://i.pravatar.cc/150?u={{ author | urlencode }}" alt="{{ author }}">
              <div>
                <h4 class="text-lg font-bold text-gray-900 dark:text-white">{{ author }}</h4>
                <p class="text-sm text-gray-500 dark:text-gray-400">Author</p>
              </div>
            </div>
            <p class="text-gray-600 dark:text-gray-400">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
          </div>
        {% endif %}

        <!-- Related Posts -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-900">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Related Posts</h3>
          <div class="space-y-4">
            <!-- This would be populated with actual related posts -->
            <a href="#" class="block hover:bg-gray-50 dark:hover:bg-gray-800 p-4 rounded-lg">
              <h4 class="font-medium text-gray-900 dark:text-white">Related Post Title 1</h4>
              <p class="text-sm text-gray-500 dark:text-gray-400">Brief description of the related post...</p>
            </a>
            <a href="#" class="block hover:bg-gray-50 dark:hover:bg-gray-800 p-4 rounded-lg">
              <h4 class="font-medium text-gray-900 dark:text-white">Related Post Title 2</h4>
              <p class="text-sm text-gray-500 dark:text-gray-400">Brief description of the related post...</p>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</article>